---

- name: Add nginx.org key
  apt_key: url=http://nginx.org/keys/nginx_signing.key state=present

- name: Add nginx.org repo
  apt_repository: repo='deb http://nginx.org/packages/ubuntu/ precise nginx' state=present
  notify: update apt-cache

- name: Install nginx
  apt: package=nginx state=present
  notify: restart nginx

#- name: Start nginx (was having issues with handler)
#  service: name=nginx state=started

- name: Delete existing default.conf (and back it up)
  file: path=/etc/nginx/conf.d/default.conf state=absent backup=yes

- name: Install discourse.conf template
  template: src=discourse.conf.j2 dest=/etc/nginx/conf.d/discourse.conf
  notify: restart nginx
  tags: nginx